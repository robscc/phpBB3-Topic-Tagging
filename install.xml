<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.0.xsd">
  <header>
    <license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
    <title lang="en-gb">phpBBFolk</title>
    <description lang="en-gb">This MOD allows topics to be tagged by users</description>
    <author-notes lang="en-gb"></author-notes>
    
	<author-group>
      <author>
        <realname>Liam</realname>
        <email>liam@nanothree.net</email>
        <username>nanothree</username>
        <homepage>http://www.nanothree.net</homepage>
        <contributions />
      </author>
    </author-group>
	
 	<mod-version>1.0.0a</mod-version>

	
    <installation>
      <level>easy</level>
      <time>600</time>
      <target-version>
        <target-primary>3.0</target-primary>
        <target-major allow="exact">3</target-major>
        <target-minor allow="exact">0</target-minor>
      </target-version>
    </installation>
		
    <history>

      <entry>
        <date>2008-07-30</date>
        <rev-version>1.0.0a</rev-version>
        <changelog lang="en-GB">
          <change>Restart of old project, files can still be found at http://www.nanothree.net/phpbb/forum/mods/</change>
          <change>Better integration of search</change>
		  <change>Tag suggestions</change>
		</changelog>
      </entry>	
	</history>
	
    <meta name="generator" content="Phpbb.ModTeam.Tools (c#)" />
  </header>
  
  <action-group>
    <!-- ACTIONS GO HERE -->
	<sql dbms="mysql">
CREATE TABLE phpbb_tags (
  topic_id int NOT NULL,
  tag varchar(255) NOT NULL,
  PRIMARY KEY  (topic_id,tag)
);
	</sql>
    <sql dbms="mysql">
INSERT INTO phpbb_config (config_name,config_value,is_dynamic) VALUES ('pbf_on', '1', '0');
    </sql>
    <sql dbms="mysql">
INSERT INTO phpbb_config (config_name,config_value,is_dynamic) VALUES ('pbf_tags', '60', '0');
    </sql>
    <sql dbms="mysql">
INSERT INTO phpbb_config (config_name,config_value,is_dynamic) VALUES ('pbf_min_font', '9', '0');
    </sql>
    <sql dbms="mysql">
INSERT INTO phpbb_config (config_name,config_value,is_dynamic) VALUES ('pbf_max_font', '28', '0');
    </sql>
    <sql dbms="mysql">
INSERT INTO phpbb_config (config_name,config_value,is_dynamic) VALUES ('pbf_colour1', '#779FBF', '0');
    </sql>
    <sql dbms="mysql">
INSERT INTO phpbb_config (config_name,config_value,is_dynamic) VALUES ('pbf_colour2', '#779FBF', '0');
    </sql>
	<copy>
		<file from="root/phpBBFolk.php" to="phpBBFolk.php" />
		<file from="root/phpBBFolk.js" to="phpBBFolk.js" />
		
		<file from="root/adm/style/acp_phpBBFolk_manage.html" to="adm/style/acp_phpBBFolk_manage.html" />
		<file from="root/adm/style/acp_phpBBFolk_configure.html" to="adm/style/acp_phpBBFolk_configure.html" />
		<file from="root/adm/style/acp_phpBBFolk_view_all.html" to="adm/style/acp_phpBBFolk_view_all.html" />
				
		<file from="root/includes/functions_phpBBFolk.php" to="includes/functions_phpBBFolk.php" />
		<file from="root/includes/ColourTools.php" to="includes/ColourTools.php" />
		<file from="root/includes/acp/acp_phpBBFolk.php" to="includes/acp/acp_phpBBFolk.php" />
		<file from="root/includes/acp/info/acp_phpBBFolk.php" to="includes/acp/info/acp_phpBBFolk.php" />
		
		<file from="root/language/en/mods/phpBBFolk_lang.php" to="language/en/mods/phpBBFolk_lang.php" />
		
		<file from="root/styles/prosilver/template/phpBBFolk_input.html" 
			  to="styles/prosilver/template/phpBBFolk_input.html" />
		<file from="root/styles/prosilver/template/phpBBFolk_search_results.html" 
			  to="styles/prosilver/template/phpBBFolk_search_results.html" />
		<file from="root/styles/prosilver/template/phpBBFolk_search.html" 
			  to="styles/prosilver/template/phpBBFolk_search.html" />
		<file from="root/styles/prosilver/template/phpBBFolk_search_results.html" 
			  to="styles/prosilver/template/phpBBFolk_search_results.html" />
		<file from="root/styles/prosilver/template/phpBBFolk_search_tags.html" 
			  to="styles/prosilver/template/phpBBFolk_search_tags.html" />
		<file from="root/styles/prosilver/template/phpBBFolk_tagcloud.html" 
			  to="styles/prosilver/template/phpBBFolk_tagcloud.html" />
		<file from="root/styles/prosilver/template/phpBBFolk_posting_tag_input.html" 
			  to="styles/prosilver/template/phpBBFolk_posting_tag_input.html" />
		<file from="root/styles/prosilver/theme/phpBBFolk.css" 
			  to="styles/prosilver/theme/phpBBFolk.css" />
  	</copy>

	<open src="common.php">
		<edit>
			<find><![CDATA[?>]]></find>
			<action type="before-add"><![CDATA[
//phpBBFolk MOD
include($phpbb_root_path . 'includes/functions_phpBBFolk.' . $phpEx);
include($phpbb_root_path . 'includes/ColourTools.' . $phpEx);
$user->add_lang('mods/phpBBFolk_lang');
//end phpBBFolk MOD
			]]></action>
		</edit>	
  	</open>	
	<open src="posting.php">
		<edit>
			<find><![CDATA[
$redirect_url = submit_post($mode, $post_data['post_subject'], $post_data['username'], $post_data['topic_type'], $poll, $data, $update_message, ($update_message || $update_subject) ? true : false);			]]></find>
			<action type="after-add"><![CDATA[//phpBBFolk MOD
$pbf_tags = request_var('pbf_tags', '');
if($config['pbf_on'] == 1 && trim($pbf_tags) != ''){
	//process tags
	insert_tags($pbf_tags, $data['topic_id']);
}
//end phpBBFolk MOD	]]></action>
		</edit>	
  	</open>	
		
	<open src="search.php">
		<edit>
			<find><![CDATA[	// For some searches we need to print out the "no results" page directly to allow re-sorting/refining the search options.
	if (!sizeof($id_ary) && !$search_id)
	{
		trigger_error('NO_SEARCH_RESULTS');
	}]]></find>
			<action type="before-add"><![CDATA[//phpBBFolk MOD
if($keywords){
	$tag_results 		= search_tags($keywords);
	$tag_results_count	= sizeof($tag_results);
	$tag_list_size		= floor($tag_results_count/2);
	$i =0;
	foreach($tag_results as $tag_row){
		
		$forum_id = $tag_row['forum_id'];
		$tag_topic_id 	= $tag_row['topic_id'];
		$topic_forum_id = $tag_row['forum_id'];
		$tag_topic_url 	= append_sid("{$phpbb_root_path}viewtopic.$phpEx", "f=$forum_id&amp;t=$tag_topic_id");
		
		if($i++ <= $tag_list_size){
			$template->assign_block_vars('relevant_topics_1', 
					array(	'TOPIC_TITLE' 	=> $i.'. '.$tag_row['topic_title'],
							'U_URL'	=> $tag_topic_url,
					)
			);
		}else{
			$template->assign_block_vars('relevant_topics_2', 
					array(	'TOPIC_TITLE' 	=> $i.'. '.$tag_row['topic_title'],
							'U_URL'	=> $tag_topic_url,
					)
			);		
		}
	}
	$template->assign_vars(array(
			'S_SHOW_TAG_RESULTS' => ($tag_results_count > 0 ? true : false),
			'TAG_MATCHES'		 => sprintf($user->lang['FOUND_SEARCH_MATCHES'], $tag_results_count),
		)
	);
}
//end phpBBFolk MOD	]]></action>
		</edit>	
  	</open>	

	<open src="viewtopic.php">
		<edit>
			<find><![CDATA[// Does this topic contain a poll?]]></find>
			<action type="before-add"><![CDATA[//phpBBFolk MOD
$template->assign_vars(array(
		'S_ADD_TAG_ACTION'		=> append_sid("{$phpbb_root_path}phpBBFolk.$phpEx", 'mode=add_tag'),
		'TOPIC_TAG_LIST'		=> get_tag_list($topic_id, 0, 'topic'),
	)
);
//end phpBBFolk MOD]]></action>
		</edit>	
  	</open>

	<open src="includes/constants.php">
		<edit>
			<find><![CDATA[// Additional tables]]></find>
			<action type="after-add"><![CDATA[//phpBBFolk MOD
define('TAGS_TABLE',				$table_prefix . 'tags');//end phpBBFolk MOD
			]]></action>
		</edit>	
  	</open>

	<open src="includes/functions.php">
		<edit>
			<find><![CDATA[// application/xhtml+xml not used because of IE
	header('Content-type: text/html; charset=UTF-8');]]></find>
			<action type="before-add"><![CDATA[//phpBBFolk MOD
    $template->assign_vars(array(
        'S_PHPBBFOLK_ON'		=> ($config['pbf_on'] == 1 ? true : false),
        'TAG_CLOUD'				=> get_tag_cloud($config['pbf_min_font'], $config['pbf_max_font'], $config['pbf_colour1'], $config['pbf_colour2'], $config['pbf_tags'])
    ));
    //end phpBBFolk MOD]]></action>
		</edit>	
  	</open>
	
	<open src="language/en/common.php">
		<edit>
			<find><![CDATA[));]]></find>
			<action type="after-add"><![CDATA[//phpBBFolk MOD
$lang = array_merge($lang, array(
		'PBF_SEARCH_TAGS'			=>	'Search tags'
));
//end phpBBFolk MOD]]></action>
		</edit>	
  	</open>

	<open src="language/en/acp/common.php">
		<edit>
			<find><![CDATA[?>]]></find>
			<action type="before-add"><![CDATA[//phpBBFolk MOD
$lang = array_merge($lang, array(
		'PBF_MANAGE'		=> 'Manage',
		'PBF_CONFIGURE'		=> 'Configure',
		'PBF_REMOVE'		=> 'Remove',
		'PBF_PHPBBFOLK'		=> 'phpBBFolk',
		'PBF_CLEAR_ORPHANS'	=> 'Clear Orphans',
		'PBF_VIEW_ALL'		=> 'View All Tags',
));
//end phpBBFolk MOD]]></action>
		</edit>	
  	</open>	

	<open src="styles/prosilver/template/overall_header.html">
		<edit>
			<find><![CDATA[<!-- IF S_BOARD_DISABLED and S_USER_LOGGED_IN and (U_MCP or U_ACP) -->
		<div id="information" class="rules">
			<div class="inner"><span class="corners-top"><span></span></span>
				<strong>{L_INFORMATION}:</strong> {L_BOARD_DISABLED}
			<span class="corners-bottom"><span></span></span></div>
		</div>
		<!-- ENDIF -->]]></find>
			<action type="after-add"><![CDATA[
        <!-- IF TAG_CLOUD and S_PHPBBFOLK_ON -->
            <!-- phpBBFolk mod -->
                <!-- INCLUDE phpBBFolk_tagcloud.html -->
            <!-- end phpBBFolk mod -->
        <!-- ENDIF -->
			]]></action>
		</edit>	
  	</open>	

	<open src="styles/prosilver/template/posting_buttons.html">
		<edit>
			<find><![CDATA[var panels = new Array('options-panel', 'attach-panel', 'poll-panel');]]></find>
			<action type="after-add"><![CDATA[//phpBBFolk MOD
<!-- IF S_PHPBBFOLK_ON and S_NEW_MESSAGE -->
panels[panels.length] = 'phpBBFolk-panel';
<!-- ENDIF -->
//end phpBBFolk MOD]]></action>
		</edit>	
  	</open>	
	
	<open src="styles/prosilver/template/posting_editor.html">
		<edit>
			<find><![CDATA[<!-- IF S_SHOW_POLL_BOX || S_POLL_DELETE --><li id="poll-panel-tab"><a href="#tabs" onclick="subPanels('poll-panel'); return false;"><span>{L_ADD_POLL}</span></a></li><!-- ENDIF -->]]></find>
			<action type="after-add"><![CDATA[<!-- phpBBFolk mod -->
<!-- IF S_PHPBBFOLK_ON and S_NEW_MESSAGE --><li id="phpBBFolk-panel-tab"><a href="#tabs" onclick="subPanels('phpBBFolk-panel'); return false;"><span>{L_PBF_ADD_TAGS}</span></a></li>
	<!-- ENDIF -->
<!-- end phpBBFolk mod -->]]></action>
		</edit>	
  	</open>	
	
	<open src="styles/prosilver/template/posting_layout.html">
		<edit>
			<find><![CDATA[<!-- IF S_DISPLAY_REVIEW --><!-- INCLUDE posting_topic_review.html --><!-- ENDIF -->]]></find>
			<action type="after-add"><![CDATA[<!-- phpBBFolk MOD -->
<!-- IF S_PHPBBFOLK_ON and S_NEW_MESSAGE --><!-- INCLUDE phpBBFolk_posting_tag_input.html --><!-- ENDIF -->
<!-- end phpBBFolk mod -->]]></action>
		</edit>	
  	</open>	

	<open src="styles/prosilver/template/search_results.html">
		<edit>
			<find><![CDATA[<!-- INCLUDE overall_header.html -->]]></find>
			<action type="after-add"><![CDATA[<!-- phpBBFolk MOD -->
<!-- INCLUDE phpBBFolk_search_tags.html -->
<!-- end phpBBFolk MOD -->]]></action>
		</edit>	
  	</open>	
	
	<open src="styles/prosilver/template/viewtopic_body.html">
		<edit>
			<find><![CDATA[<!-- INCLUDE jumpbox.html -->]]></find>
			<action type="before-add"><![CDATA[<!-- phpBBFolk mod -->
<!-- IF TOPIC_TAG_LIST and S_PHPBBFOLK_ON -->
	<h3>{L_PBF_TOPIC_TAGS}</h3>
	{TOPIC_TAG_LIST}
<!-- ENDIF --> 	
<!-- IF not S_IS_BOT and S_USER_LOGGED_IN and S_PHPBBFOLK_ON -->
	<!-- INCLUDE phpBBFolk_input.html -->
<!-- ENDIF -->
<!-- end phpBBFolk mod -->]]></action>
		</edit>	
  	</open>	

	<open src="styles/prosilver/theme/stylesheet.css">
		<edit>
			<find><![CDATA[@import url("colours.css");]]></find>
			<action type="after-add"><![CDATA[/* phpBBFolk MOD */
@import url("phpBBFolk.css");
/* end phpBBFolk MOD */]]></action>
		</edit>	
  	</open>						
  </action-group>
</mod>

